# DocuVerse 에디터 라이브러리 기술 문서

## 1. 에디터 핵심 기능 요구사항

### 마크다운 (Markdown) 지원
- 기본적인 텍스트 작성과 서식 지정, 목록, 링크 등을 마크다운 문법을 사용하여 지원
- 코드 블록 및 구문 강조 기능 제공

### HTML 태그 지원
- 사용자가 HTML 태그를 삽입할 수 있는 기능
- 복잡한 구조나 스타일링을 위한 HTML 태그 활용
- 보안을 위해 허용된 HTML 태그와 속성만 필터링하여 사용

### 나무위키 스타일 에디터 지원
- **나무위키 문법 지원**: 나무위키 고유의 마크업 문법을 지원하여 직관적인 문서화
- **나무위키 표 기능**: 복잡한 데이터 구조를 표현할 수 있는 나무위키 스타일의 표 기능
  - 셀 병합, 배경색 지정, 정렬 등 다양한 표 속성 지원
  - 표 내부에 다른 문법 요소 중첩 지원 (표 안에 리스트, 링크, 이미지 등)
- **문서 구조화 기능**: 목차 자동 생성, 문단별 편집, 접기/펼치기 기능 등 구현

### CSS로 꾸미기 지원
- 문서에 CSS를 사용하여 스타일링을 추가할 수 있는 기능
- 미리 정의된 테마를 선택할 수 있는 옵션 제공

## 2. 기술 스택

### 프론트엔드 기술
- **에디터 라이브러리**: 
  - 마크다운 에디터: ProseMirror 또는 TipTap (ProseMirror 기반)
  - 협업 기능: yjs (실시간 협업 데이터 구조)

## 3. 사용자 경험 (UX/UI)

### 직관적인 에디터
- **WYSIWYG + 마크다운**: 시각적 에디터와 마크다운 모드 전환 가능
- **드래그 앤 드롭**: 이미지나 파일을 드래그하여 쉽게 첨부
- **단축키**: 자주 사용하는 기능에 단축키 제공
- **미리보기**: 작성 중인 문서의 최종 결과물 미리보기

## 4. 나무위키 스타일 에디터 구현 계획

### 주요 에디터 기능
1. **나무위키 문법 지원**:
   - 나무위키 고유의 마크업 문법을 완벽하게 지원하는 파서 개발
   - 제목, 목록, 인용, 각주, 링크 등 나무위키 특유의 문법 구현
   - 나무위키 스타일의 접기/펼치기 기능 구현

2. **핵심 표 기능 구현**:
   - 나무위키의 표 문법을 정확히 파싱하고 렌더링하는 기능 개발
   - 셀 병합, 배경색 지정, 정렬 등 나무위키 표의 모든 속성 지원
   - 표 내부에 다른 나무위키 문법 요소 중첩 지원 (표 안에 리스트, 링크 등)
   - 직관적인 표 편집 UI로 복잡한 표 문법을 몰라도 쉽게 사용 가능하게 구현

3. **문서 구조화 기능**:
   - 문서 내 목차 자동 생성 및 네비게이션
   - 문단별 편집 기능
   - 북마크 및 앵커 기능

### 기술적 접근 방법
1. **커스텀 파서 구현**:
   - 나무위키 문법 전용 파서 개발 (PEG.js 또는 자체 개발)
   - AST(Abstract Syntax Tree) 기반 문서 구조 관리

2. **에디터 프레임워크 확장**:
   - ProseMirror를 기반으로 나무위키 문법에 맞는 스키마 및 플러그인 개발
   - 특히 표 기능을 위한 특화된 노드 타입 및 커맨드 구현
   - prosemirror-tables를 확장하여 나무위키 표 문법의 모든 기능 지원

3. **양방향 변환 시스템**:
   - 나무위키 문법 ↔ 에디터 상태 ↔ HTML 간의 완벽한 양방향 변환
   - 문법의 손실 없는 라운드트립 보장

### 사용자 인터페이스
- **듀얼 모드**: 시각적 에디터와 문법 에디터 간 자유로운 전환
- **표 전용 툴바**: 표 생성, 행/열 추가 및 삭제, 셀 병합, 배경색 설정 등 표 관련 작업을 위한 전용 툴바
- **표 템플릿**: 자주 사용되는 표 형식을 템플릿으로 제공
- **단축키 지원**: 표 조작을 위한 풍부한 키보드 단축키
- **드래그 앤 드롭**: 표 내 행과 열의 순서 변경, 크기 조절 등을 마우스로 조작

## 5. 실시간 협업 기능 구현 계획

### 기술적 접근 방법
1. **CRDT 기반 협업**:
   - Conflict-free Replicated Data Type(CRDT)를 사용하여 동시 편집 충돌 해결
   - yjs 라이브러리를 활용한 문서 동기화

2. **네트워크 계층**:
   - WebSocket을 통한 실시간 통신
   - y-websocket 또는 Socket.io 활용

3. **상태 동기화**:
   - 문서 변경 사항을 델타(변경 단위)로 전송
   - 네트워크 단절 시 로컬에서 변경 내용 유지 및 재연결 시 동기화

### 사용자 경험
- **사용자 존재감**: 현재 문서를 보고 있는 사용자 표시
- **커서 위치 공유**: 다른 사용자의 커서 위치 실시간 표시
- **변경 사항 하이라이트**: 최근 변경된 부분 시각적으로 표시
- **충돌 해결 UI**: 드물게 발생할 수 있는 충돌 상황을 해결하기 위한 인터페이스

## 6. 보안 고려사항

- **안전한 HTML 필터링**: DOMPurify 등을 활용한 HTML 샌드박싱
- HTML 태그 및 속성 화이트리스트 관리
- XSS 공격 방지를 위한 보안 조치

## 7. 개발 로드맵

### 1단계: 기본 에디터 개발
- 기본 마크다운 에디터 구현
- 기본적인 HTML 태그 지원 구현
- 단순한 표 기능 구현

### 2단계: 나무위키 스타일 에디터 개발
- 나무위키 문법 파서 개발
- 나무위키 스타일 표 기능 구현
- 문서 구조화 기능 구현

### 3단계: 실시간 협업 기능 개발
- yjs 통합 및 실시간 협업 기능 구현
- 사용자 존재감 및 커서 위치 공유 기능 개발
- 충돌 해결 시스템 구현

### 4단계: 최적화 및 고급 기능
- 성능 최적화
- CSS 스타일링 및 테마 지원 개선
- 고급 단축키 및 플러그인 시스템 개발